#include<reg52.h>


sbit T_CLK = P2^7;      //时钟 对应sk
sbit T_STR = P2^6;      //锁存 对应lt
sbit T_IO  = P2^5;       //数据1
sbit T_IO2  = P2^4;       //数据2
sbit EN=P3^6;
sfr P2M1=0x95;
sfr P2M0=0x96;


unsigned char DIS[]={0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15};

unsigned char code messagesBuf[]={

/*--  文字:  您  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x08,0x00,0x09,0x00,0x11,0xFE,0x12,0x04,0x34,0x40,0x32,0x50,0x52,0x48,0x94,0x44,
0x11,0x44,0x10,0x80,0x00,0x00,0x29,0x04,0x28,0x92,0x68,0x12,0x07,0xF0,0x00,0x00,
/*--  文字:  欢  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x00,0x80,0x00,0x80,0xFC,0x80,0x05,0xFE,0x85,0x04,0x4A,0x48,0x28,0x40,0x10,0x40,
0x18,0x40,0x18,0x60,0x24,0xA0,0x24,0x90,0x41,0x18,0x86,0x0E,0x38,0x04,0x00,0x00,

/*--  文字:  迎  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x40,0x00,0x21,0x80,0x36,0x7C,0x24,0x44,0x04,0x44,0x04,0x44,0xE4,0x44,0x24,0x44,
0x25,0x44,0x26,0x54,0x24,0x48,0x20,0x40,0x20,0x40,0x50,0x00,0x8F,0xFE,0x00,0x00,


/*--  文字:  使  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x08,0x40,0x0C,0x40,0x1B,0xFE,0x10,0x40,0x37,0xFC,0x64,0x44,0xA4,0x44,0x27,0xFC,
0x24,0x44,0x22,0x40,0x21,0x80,0x20,0x80,0x21,0x70,0x22,0x1E,0x2C,0x04,0x00,0x00,

/*--  文字:  用  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x00,0x00,0x1F,0xFC,0x10,0x84,0x10,0x84,0x10,0x84,0x1F,0xFC,0x10,0x84,0x10,0x84,
0x10,0x84,0x1F,0xFC,0x10,0x84,0x10,0x84,0x20,0x84,0x20,0x84,0x40,0x94,0x80,0x88,

/*--  文字:  矿  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x00,0x20,0xFE,0x10,0x11,0xFE,0x11,0x00,0x11,0x00,0x21,0x00,0x3D,0x00,0x25,0x00,
0x65,0x00,0xA5,0x00,0x25,0x00,0x25,0x00,0x3D,0x00,0x26,0x00,0x22,0x00,0x04,0x00,

/*--  文字:  灯  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x10,0x00,0x10,0x00,0x11,0xFE,0x10,0x10,0x54,0x10,0x54,0x10,0x58,0x10,0x90,0x10,
0x10,0x10,0x18,0x10,0x24,0x10,0x22,0x10,0x40,0x10,0x40,0x50,0x80,0x20,0x00,0x00,

/*--  文字:  充  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x02,0x00,0x01,0x00,0x7F,0xFC,0x02,0x00,0x07,0x40,0x0C,0x20,0x10,0x10,0x3F,0xF8,
0x04,0x90,0x04,0x80,0x04,0x80,0x08,0x80,0x08,0x84,0x10,0x84,0x20,0x7C,0x40,0x00,

/*--  文字:  电  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x01,0x00,0x01,0x00,0x01,0x00,0x3F,0xF8,0x21,0x08,0x21,0x08,0x3F,0xF8,0x21,0x08,
0x21,0x08,0x21,0x08,0x3F,0xF8,0x21,0x08,0x01,0x02,0x01,0x02,0x00,0xFE,0x00,0x00,

/*--  文字:  架  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x08,0x00,0x08,0x00,0x7F,0x7C,0x09,0x44,0x09,0x44,0x11,0x44,0x15,0x7C,0x62,0x00,
0x01,0x00,0x7F,0xFC,0x03,0x80,0x05,0x40,0x09,0x30,0x31,0x0E,0xC1,0x04,0x01,0x00,

/*--  文字:  智  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x20,0x00,0x3F,0x00,0x48,0x7C,0x08,0x44,0xFF,0x44,0x0C,0x44,0x0A,0x7C,0x11,0x00,
0x6F,0xF0,0x08,0x10,0x08,0x10,0x0F,0xF0,0x08,0x10,0x08,0x10,0x0F,0xF0,0x08,0x10,

/*--  文字:  能  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x20,0x40,0x30,0x40,0x24,0x4C,0x42,0x70,0xFF,0x44,0x42,0x46,0x00,0x7C,0x7E,0x00,
0x42,0x40,0x7E,0x4C,0x42,0x70,0x7E,0x40,0x42,0x44,0x42,0x46,0x4A,0x3C,0x44,0x00,

/*--  文字:  管  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x20,0x80,0x3E,0xFC,0x51,0x20,0x8A,0x10,0x01,0x00,0x7F,0xFE,0x40,0x04,0x1F,0xE0,
0x10,0x20,0x1F,0xE0,0x10,0x00,0x1F,0xF0,0x10,0x10,0x10,0x10,0x1F,0xF0,0x10,0x10,

/*--  文字:  理  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x00,0x00,0x03,0xFC,0xFA,0x44,0x22,0x44,0x23,0xFC,0x22,0x44,0xFA,0x44,0x23,0xFC,
0x22,0x44,0x20,0x40,0x23,0xFC,0x38,0x40,0xC0,0x40,0x00,0x40,0x0F,0xFE,0x00,0x00,

/*--  文字:  系  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x00,0x7C,0x3F,0x80,0x02,0x20,0x04,0x20,0x08,0x40,0x1F,0x80,0x03,0x20,0x0C,0x10,
0x3F,0xF8,0x10,0x8C,0x04,0xA0,0x08,0x90,0x10,0x88,0x20,0x84,0x42,0x84,0x01,0x00,

/*--  文字:  统  --*/
/*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
0x10,0x40,0x10,0x20,0x23,0xFE,0x20,0x40,0x44,0x40,0xF8,0x88,0x09,0x04,0x13,0xFE,
0x20,0x94,0x7C,0x90,0x00,0x90,0x00,0x90,0x1D,0x12,0xE1,0x12,0x02,0x0E,0x04,0x00,



};

/*
void delayUs2x(unsigned char t) {
	while (--t)
		;
}

void delayMs(unsigned int t) {

	while (t--) {

		delayUs2x(245);
		delayUs2x(245);
	}
}
*/
void InputByte(unsigned  char ucDa) 
{ 
	unsigned char i;
	for(i=8; i>0; i--)
	{
		T_IO = !((ucDa>>7)&0x01); 
		T_CLK =	0;                  
		T_CLK = 1;
		ucDa=ucDa<<1;
	} 
}


void Init_Timer0(void)
{
	TMOD |= 0x01;			     
	TH0=0xff;	             
	TL0=0x00;
	EA=1;                    
	ET0=1;                     
	TR0=1;                   
}

bit isRefresh;
unsigned char timerCount=0,timerI,timerJ;
void Timer0_isr(void) interrupt 1 using 1
{

	TH0=0xfe;		
	TL0=0x00; 
	if(isRefresh==0){
	 isRefresh=1;
	}

}

void timerAction(){
	if(isRefresh==0){
		return;
	}
	for(timerJ=0;timerJ<16;timerJ++) 
	{
		InputByte(messagesBuf[timerJ*32+timerI]);
		InputByte(messagesBuf[timerJ*32+timerI+1]);
	}
	T_STR=0; 
	T_STR=1; 
	P2=(P2&0xf0)|DIS[timerCount];
	timerCount++;
	timerI+=2;             
	if(timerCount==16)
	timerCount=0;
	if(timerI==32)
	{
		timerI=0;
	}
	isRefresh=0;
}

main()
{

	P2M0=0x0f;	
	EN=0;
	Init_Timer0(); 
	
	while(1)
	{ 
	timerAction();
	
	}
}
